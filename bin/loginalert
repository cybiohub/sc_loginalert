#! /bin/bash
#set -x
# * **************************************************************************
# * Creation:           (c) 2004-2022  Cybionet - Ugly Codes Division
# *
# * File:               loginalert
# * Version:            0.2.7
# *
# * Comment:            Script that alerts when accessing the root account.
# *
# * Date: March 22, 2021
# * Modification: February 11, 2022
# *
# * **************************************************************************
# *
# * chown root:root loginalert
# * chmod 500 loginalert
# * mv loginalert /usr/bin
# *
# *
# * vim /etc/pam.d/
# *     login
# *     sshd
# *     su
# *     sudo (optional)
# *
# *     session optional pam_exec.so /usr/bin/loginalert
# *
# *
# * PICTURE
# *  Max Size: 312 x 56
# *
# *  cat picture.jpg | base64
# *  src=\"data:image/jpeg;base64,
# *  src=\"data:image/png;base64,
# *  src=\"data:image/svg+xml;base64,
# *
# * **************************************************************************

#############################################################################################
# ## CUSTOMIZABLE CONSTANTS/VARIABLES

readonly emailTo='user@example.com'	 			# ## Single recipient
#readonly emailTo='user1@example.com, user2@example.com' 	# ## Multiple recipients
readonly emailFrom='alert@example'

#readonly ALLOWIP='140.82.112.3'				# ## Unique IP.
#readonly ALLOWIP='140.82.112.3 172.65.251.78'	 		# ## Multiple IP.
readonly ALLOWIP='192.168.0'					# ## IP Range.
#readonly ALLOWIP='172.16.0 192.168.0'				# ## Multiple IP Range.

readonly excludedUsers='ansible_user'                           # ## To exclude users used for automated scripts (Ex.: Ansible).

myLogoAlt='Cybionet'                                            # ## Alternate name for the logo.
myLogoMime='png;base64'						# ## Supported Types: jpeg;base64, png;base64 or svg+xml;base64.

# ## Put your base64 image logo here.
myLogo='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'

declare -r version="v0.2.6"


#####################################################################
# ## GLOBAL VARIABLES

readonly APPMAIL='/usr/bin/mutt'

readonly myHost=$(hostname -s)
readonly myDate=$(date +"%B %d, %Y  %H:%M:%S (%Z)")

if [[ "${PAM_RHOST}" =~ ^[[:alpha:]] ]]; then
  ipAddr=$(getent hosts "${PAM_RHOST}" | awk '{print $1}')
else
  ipAddr="${PAM_RHOST}"
fi

readonly reportHeader='ALERT REPORT'
readonly reportSubTitle="Your <strong>${PAM_USER}</strong> account was used to log in to <strong>${myHost}</strong> machine."

readonly reportTitleHigh='Login From Unkown Device'
readonly reportSeverityHigh='High'
readonly reportSeverityClassHigh='font-size:15pt;color:#e81123;font-weight:bold'

#readonly reportTitleMedium='Login From Authorized Device'
#readonly reportSeverityMedium='Medium'
#readonly reportSeverityClassMedium='font-size:15pt;color:##ff8e00;font-weight:bold'

readonly reportTitleLow='Login From Authorized Device'
readonly reportTitleLowLogin='Login From Console'
readonly reportTitleLowSu='Login With Privilege Escalation'
readonly reportSeverityLow='Low'
readonly reportSeverityClassLow='font-size:15pt;color:#FFA059;font-weight:bold'

readonly myPath=$(dirname "${0}")
readonly reportContent="${myPath}/email.html"


#####################################################################
# ## FUNCTIONS

# ## Check Script dependencies.
function checkifMuttExist {
 readonly APPDEP='mutt'

 # ## Check if Mutt services is installed.
 if ! dpkg-query -s "${APPDEP}" > /dev/null 2>&1; then
   echo -e "\e[34;1;208mINFORMATION:\e[0m Installing the required dependencies (${APPDEP})."
   apt-get install -y "${APPDEP}"
 fi

 # ## Check if Whois package is installed.
 if ! dpkg-query -s "whois" > /dev/null 2>&1; then
   echo -e "\e[34;1;208mINFORMATION:\e[0m Installing the required dependencies Whois)."
   apt-get install -y whois
 fi

 # ## Check if Gpgsm package is installed.
 if ! dpkg-query -s "gpgsm" > /dev/null 2>&1; then
   echo -e "\e[34;1;208mINFORMATION:\e[0m Installing the required dependencies Gpgsm)."
   apt-get install -y gpgsm
 fi
}

# ## Checks if the IP address is in the list.
function ipMatchListorNot {
 # ## Put IP Address in array.
 declare -a authorizedIP=($(printf "${ALLOWIP}"))

 if [ -z "${ipAddr}" ]; then
   ipAddr='Error'
   reportTitle="Error"
 fi

 for item in "${authorizedIP[@]}"; do
  if [[ "${ipAddr}" =~ ${item} ]]; then
# ## Authentification SSH dans la liste autorisée (PAM_SERVICE est SSH)
      # ## Severity Low (remote).
      reportTitle="${reportTitleLow}"
      reportSeverity="${reportSeverityLow}"
      reportSeverityClass="${reportSeverityClassLow}"
      reportWarn="#ffffff"
      break
  else
    # ## Authentification LOGIN (aucun PAM_RUSER et PAM_SERVICE est LOGIN)
    if [[ -z "${PAM_RUSER}" && "${PAM_SERVICE}" == "login" ]]; then
      # ## Severity Low (local).
      reportTitle="${reportTitleLowLogin}"
      reportSeverity="${reportSeverityLow}"
      reportSeverityClass="${reportSeverityClassLow}"
      reportWarn="#ffffff"
    elif [[ "${PAM_SERVICE}" =~ ^(su.*|sudo)$ ]]; then
    # ## Authentification SUDO et SU ( PAM_TTY est PTS)
      # ## Severity Low (local).
      reportTitle="${reportTitleLowSu}"
      reportSeverity="${reportSeverityLow}"
      reportSeverityClass="${reportSeverityClassLow}"
      reportWarn="#ffffff"
    else
    # ## Authentification SSH PAS dans la liste autorisée (PAM_SERVICE est SSH)
      # ## Severity High (remote).
      reportTitle="${reportTitleHigh}"
      reportSeverity="${reportSeverityHigh}"
      reportSeverityClass="${reportSeverityClassHigh}"
      reportWarn="#ff0000"
    fi
  fi
 done
}


# ## Check that the IP address is not an internet address.
function ipRFC1918 {
 PATTERN='^10\.'         # 10.0.0.0/8
 PATTERN+='|^172\.16\.'  # 172.16.0.0/12
 PATTERN+='|^192\.168\.' # 192.168.0.0/16
 PATTERN+='|^169\.254\.' # not strictly private range, but link local

 for i in {seq 16 31} ; do
  PATTERN+="|^10\.$i\."
  PATTERN+="|^172\.16\.$i\."
  PATTERN+="|^192\.168\.$i\."
  PATTERN+="|^169\.254\.$i\."
 done

 resulta=$(echo ${ipAddr} | grep -E "$PATTERN")

 if [ -z "${resulta}" ]; then
   ipCountry=$(whois -H "${ipAddr}" | grep -i country | uniq | awk -F ":" '{print $2}' | sed 's/ *$//' | sed -e 's/[ \t]*//')
 else
   ipCountry="RFC 1918"
 fi
}

# ## Header et CSS.
function setHtmlHeader {
 # ## Create/clear html file.
 echo "" > "${reportContent}"

 # ## Adding a header in html file.
echo -e "
<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">
<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\">
<head>
<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />
<meta name=\"x-apple-disable-message-reformatting\" />
<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />
<style type=\"text/css\">
    body, .maintable { height:100% !important; width:100% !important; margin:0; padding:0;}
    img, a img { border:0; outline:none; text-decoration:none;}
    p {margin-top:0; margin-right:0; margin-left:0; padding:0;}
    .ReadMsgBody {width:100%;}
    .ExternalClass {width:100%;}
    .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div {line-height:100%;}
    img {-ms-interpolation-mode: bicubic;}
    body, table, td, p, a, li, blockquote {-ms-text-size-adjust:100%; -webkit-text-size-adjust:100%;}

    .lge {font-size:28pt;font-family:Segoe UI Light;color:#222}
    .rgl {font-size:13pt;font-family:Segoe UI Light;color:#222}
    .hlt {font-size:13pt;font-family:Segoe UI Bold;color:#222}
    .add {font-size:8pt;font-family:Segoe UI Light;color:#666}
    .btnb {background:#2172B9}
    .btn {font-size:15pt;font-family:Segoe UI;background:#2172B9;color:#fff;text-decoration:none;display:inline-block;padding: 6px 20px; border: 1px solid #2172B9;}
    .symblue {font-size:15pt;color:#7499FF;font-weight:bold }
    .symgreen {font-size:15pt;color:#00ff00:font-weight:bold }
    .symyellow {font-size:15pt;color:#FFA059;font-weight:bold }
    .symorange {font-size:15pt;color:##ff8e00;font-weight:bold }
    .symred {font-size:15pt;color:#e81123;font-weight:bold }
 </style>

 <style type=\"text/css\">
 @media only screen and (max-width: 480px) {
 .rtable {width: 100% !important;}
 .rtable tr {height:auto !important; display: block;}
 .contenttd {max-width: 100% !important; display: block; width: auto !important;}
 .contenttd:after {content: \"\"; display: table; clear: both;}
 .hiddentds {display: none;}
 .imgtable, .imgtable table {max-width: 100% !important; height: auto; float: none; margin: 0 auto;}
 .imgtable.btnset td {display: inline-block;}
 .imgtable img {width: 100%; height: auto !important;display: block;}
 table {float: none;}
 .mobileHide {display: none !important;}
}
@media only screen and (min-width: 481px) {
 .desktopHide {display: none !important;}
}
</style>
<!--[if gte mso 9]>
<xml>
  <o:OfficeDocumentSettings>
    <o:AllowPNG/>
    <o:PixelsPerInch>96</o:PixelsPerInch>
  </o:OfficeDocumentSettings>
</xml>
<![endif]-->
<title></title>
</head>

<body style=\"overflow: auto; padding:0; margin:0; font-size: 12px; font-family: arial, helvetica, sans-serif; cursor:auto; background-color:#f0f0f0\">
" >> "${reportContent}"
}

# ## Summary of access.
function emailSumHeader {
echo -e "
 <table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f0f0f0\">
  <tr>
    <td style=\"FONT-SIZE: 0px; HEIGHT: 0px; LINE-HEIGHT: 0\"></td>
  </tr>
  <tr>
    <td valign=\"top\">

<!-- Space -->
<table style=\"WIDTH: 100%\" cellspacing=\"0\" cellpadding=\"0\" align=\"left\">
 <tr style=\"HEIGHT: 20px\" height=\"20\">
  <th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 616px; VERTICAL-ALIGN: middle; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 10px; TEXT-ALIGN: left; PADDING-TOP: 10px; PADDING-LEFT: 10px; BORDER-LEFT: medium none; PADDING-RIGHT: 10px\">
  </th>
 </tr>
</table>

<!-- Top -->
    <table class=\"rtable\" style=\"WIDTH: 636px; MARGIN: 0px auto\" cellspacing=\"0\" cellpadding=\"0\" width=\"636\" align=\"center\" border=\"0\">
    <tr>
      <th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 636px; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 0px; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; PADDING-RIGHT: 0px; BACKGROUND-COLOR: #0176ec\">


      <table style=\"WIDTH: 100%\" cellspacing=\"0\" cellpadding=\"0\" align=\"left\">
    <tr style=\"HEIGHT: 73px\" height=\"73\">
    <tr style=\"HEIGHT: 73px\" height=\"73\">
      <th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 298px; VERTICAL-ALIGN: top; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 10px; TEXT-ALIGN: left; PADDING-TOP: 10px; PADDING-LEFT: 10px; BORDER-LEFT: medium none; PADDING-RIGHT: 10px; BACKGROUND-COLOR: transparent\"><!--[if gte mso 12]>


      <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\"><tr><td align=\"center\">
<![endif]-->
<table class=\"imgtable\" style=\"MARGIN: 0px auto\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" border=\"0\">
<tr>
<td style=\"PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px\" align=\"center\">
<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\">
<tr>

<!-- BEGIN IMAGE -->
<td style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; BACKGROUND-COLOR: transparent\"><img style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; DISPLAY: block\" alt=\"${myLogoAlt}\" src=\"data:image/\"${myLogoMime}\",
${myLogo}
\" width=\"298\" hspace=\"0\" vspace=\"0\" /></td>
<!-- END IMAGE -->

</tr>
</table>
</td>
</tr>
</table>
<!--[if gte mso 12]>
    </td></tr></table>
<![endif]--></th>


<!-- Titre -->
<th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 298px; VERTICAL-ALIGN: bottom; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 0px; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 10px; BORDER-LEFT: medium none; PADDING-RIGHT: 10px; BACKGROUND-COLOR: transparent\">
<p style=\"FONT-SIZE: 24px; MARGIN-BOTTOM: 1em; FONT-FAMILY: arial, helvetica, sans-serif; MARGIN-TOP: 0px; COLOR: #feffff; TEXT-ALIGN: right; LINE-HEIGHT: 30px; BACKGROUND-COLOR: transparent; mso-line-height-rule: exactly\" align=\"right\"><strong>${reportHeader}&nbsp;</strong></p>
</th>
</tr>
</table>
</th>
</tr>
<tr>
<th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 636px; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 0px; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; PADDING-RIGHT: 0px; BACKGROUND-COLOR: #cecece\">

<table style=\"WIDTH: 100%\" cellspacing=\"0\" cellpadding=\"0\" align=\"left\" data-hidewhenresp=\"0\">
 <tr style=\"HEIGHT: 87px\" height=\"87\">
  <th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 616px; VERTICAL-ALIGN: top; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 10px; TEXT-ALIGN: left; PADDING-TOP: 10px; PADDING-LEFT: 10px; BORDER-LEFT: medium none; PADDING-RIGHT: 10px; BACKGROUND-COLOR: transparent\">
   <p style=\"FONT-SIZE: 32px; MARGIN-BOTTOM: 0px; FONT-FAMILY: arial, helvetica, sans-serif; MARGIN-TOP: 0px; COLOR: #424242; TEXT-ALIGN: left; LINE-HEIGHT: 56px; BACKGROUND-COLOR: transparent; mso-line-height-rule: exactly\" align=\"left\">${reportTitle}</p>
  </th>
 </tr>
</table>
</th>
</tr>

<!-- Ligne -->
<tr>
<th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 636px; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 0px; TEXT-ALIGN: left; PADDING-TOP: 10px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; PADDING-RIGHT: 0px; BACKGROUND-COLOR: ${reportWarn}\">
</th>
</tr>

<tr>
 <th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 636px; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 0px; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; PADDING-RIGHT: 0px; BACKGROUND-COLOR: #ffffff\">

<table style=\"WIDTH: 100%\" cellspacing=\"0\" cellpadding=\"0\" align=\"left\">
 <tr style=\"HEIGHT: 173px\" height=\"173\">
  <th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 616px; VERTICAL-ALIGN: top; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 10px; TEXT-ALIGN: left; PADDING-TOP: 10px; PADDING-LEFT: 10px; BORDER-LEFT: medium none; PADDING-RIGHT: 10px; BACKGROUND-COLOR: transparent\">
   <p style=\"FONT-SIZE: 18px; MARGIN-BOTTOM: 1em; FONT-FAMILY: arial, helvetica, sans-serif; MARGIN-TOP: 0px; COLOR: #424242; TEXT-ALIGN: left; LINE-HEIGHT: 28px; BACKGROUND-COLOR: transparent; mso-line-height-rule: exactly\" align=\"left\">${reportSubTitle}</p>

<!-- Report -->
   <p style=\"FONT-SIZE:14px; MARGIN-BOTTOM:1em; FONT-FAMILY:arial,helvetica,sans-serif; MARGIN-TOP:0px; TEXT-ALIGN: left; LINE-HEIGHT: 19px; BACKGROUND-COLOR: transparent; mso-line-height-rule: exactly\" align=\"left\">

   <strong>Severity:<font style=\"FONT-SIZE:14px;${reportSeverityClass}\"> ${reportSeverity}&nbsp;</font></strong><br />
   Date and Time: ${myDate}<br />
   <br />
   User: ${PAM_USER}&nbsp;<br />

   ${infoDetail}

   Service: ${PAM_SERVICE}&nbsp;<br />
   TTY: ${PAM_TTY}</p>
  </th>
 </tr>
</table>

</th>
</tr>
<tr>
<!-- Ligne -->
<th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 636px; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 0px; TEXT-ALIGN: left; PADDING-TOP: 10px; PADDING-LEFT: 0px; BORDER-LEFT: medium none; PADDING-RIGHT: 0px; BACKGROUND-COLOR: ${reportWarn}\">

<table style=\"WIDTH: 100%\" cellspacing=\"0\" cellpadding=\"0\" align=\"left\">
 <tr style=\"HEIGHT: 20px\" height=\"20\">
  <th class=\"contenttd\" style=\"BORDER-TOP: medium none; BORDER-RIGHT: medium none; WIDTH: 616px; VERTICAL-ALIGN: middle; BORDER-BOTTOM: medium none; FONT-WEIGHT: normal; PADDING-BOTTOM: 10px; TEXT-ALIGN: left; PADDING-TOP: 10px; PADDING-LEFT: 10px; BORDER-LEFT: medium none; PADDING-RIGHT: 10px; BACKGROUND-COLOR: #0176ec\">
  </th>
 </tr>
</table>

     </th>
    </tr>
   </table>
  </td>
 </tr>
 <tr>
   <td style=\"FONT-SIZE: 8px; HEIGHT: 8px; LINE-HEIGHT: 0\">${version}&nbsp;</td>
 </tr>
</table>"
} >> "${reportContent}"

# ## Adding html footer.
function setFooter {
 echo -e "
 </body>
 </html>"
} >> "${reportContent}"

# ## Sending email.
function sendMail {
 if [ -f "${reportContent}" ]; then
   ${APPMAIL} -e 'set content_type=text/html' -e "my_hdr From:${emailFrom}" "${emailTo}" -s "${emailSubject}" < "${reportContent}"
 else
   echo -e '\n\e[33mERROR: No HTML report found.\e[0m'
 fi
}


#####################################################################
# ## EXECUTION

# ## Check if the script are running under root user.
if [ "${EUID}" -ne 0 ] ; then
  echo -e '\n\e[33mWARNING: This script must be run with sudo or as root.\e[0m'
  exit 0
fi

# ## Clear screen.
clear

# ## Check dependencies.
checkifMuttExist

# ## Did IP address match the autorized list.
if [ "${PAM_TYPE}" != "open_session" ]; then
  exit 0
else {

 # ## USER EXCLUSION
  declare -a excludedUser=($(printf "${excludedUsers}"))

  for item in "${excludedUser[@]}"; do
    #if [[ "${excludedUser}" == "${PAM_USER}" || "${excludedUser}" == "${PAM_RUSER}" ]]; then
    if [[ "${item}" == "${PAM_USER}" || "${item}" == "${PAM_RUSER}" ]]; then
      exit 0
    fi
  done

 # ## SU/SUDO
  if [[ "${PAM_SERVICE}" =~ ^(su.*|sudo)$ ]]; then

    if [[ "${PAM_SERVICE}" == "sudo" && -z "${PAM_TTY}" ]]; then
      exit 0
    fi

    infoDetail="      From User: ${PAM_RUSER}&nbsp;<br /><br />"
    ipMatchListorNot

    emailSubject="Alert: ${PAM_USER} Access with privilege escalation on ${myHost}"

 # ## LOGIN
  elif [[ "${PAM_SERVICE}" =~ ^(login)$ ]]; then

    infoDetail="      <br />"
    ipMatchListorNot

    emailSubject="Alert: ${PAM_USER} Access from console on ${myHost}"
  else
 # ## SSH
    ipMatchListorNot
    ipRFC1918

    infoDetail="
      <br />Device IP: ${ipAddr}&nbsp;<br />
      Country: ${ipCountry}&nbsp;<br /><br />
    "

    emailSubject="Alert: ${PAM_USER} Access from ${ipAddr} on ${myHost}"
  fi

 
    # ## Builds HTML email.
    setHtmlHeader
    emailSumHeader

    setFooter

    # ## Sending HTML report.
    sendMail
} fi

# ## Exit.
exit 0

# ## END
